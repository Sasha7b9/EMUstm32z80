                      Ура, это произошло!Предлагаю вашему вниманию описание пзу, которому нет равных, иновой версии тырдоса.1. О чем это я...Данная вещь представляет собой прошивку Пзу длясинклер-совместимых машин, которые имеют возможность обращения встаршую четверть м/с 27(c)512 или выше...Обращение происходит по сигналу сброса следующим образом: Приустановке линии reset компа в состояние низкого уровня принимаютнулевое значение биты порта #7ffd, что приводит к запуску прогииз второго банка ПЗУ, а именно 128 бейсик. В большинствевстречавшихся компов именно так и есть. Но, дабы запустить прогуиз старшей четверти необходимо, чтобы ко всему вышеизложенномулиния reset воздействовала и на контроллер tr-dosа, что приведетк установке в окно tr-dosовской прошивки, а так как а14=0(благодаря порту #7ffd), то переход будет сделан в мою прошивку.Таким образом, появляется возможность получить небывалый сервис,просто нажав на сброс, которой я и воспользовался.Для [censored] привожу схему распределения страниц Пзу:      ┌──────────────┐A14=0 │     МОЯ      │A15=0 │   ПРОШИВКА   │      └──────────────┘      ┌──────────────┐A14=1 │   ПРОШИВКА   │A15=0 │    TR-DOS    │      └──────────────┘      ┌──────────────┐A14=0 │  BASIC 128   │A15=1 │              │      └──────────────┘      ┌──────────────┐A14=1 │  BASIC48     │A15=1 │              │      └──────────────┘Наиболее частая ситуация ^^^^^, но может быть по другому...Адреса имеются в виду на микросхеме пзу, а не процессорные.Следует отметить, что А14 управляется 4-м битом #7ffd, а А15управляется контроллером tr-dos.Приведенная информация носит академический интерес, если у васесть что-либо аналогичное - то вам просто надо перешить. Квладельцам (с)корпиона, я думаю, это не относится... Кстатисказать, на профи уже все сделано, только там прошит тупой тест.Выбирать вам... Пусть тот кто скажет, что он нужен (я тест имеюв виду), пусть первый бросит в меня мылом.Итак разобрались...2. А что оно умеет?Много.3. Как много?Глюк сервис (я так назвал) имеет встроенный (-ую):- perfect commander 1.52,- boot-загрузчик- утилиту для работы с каталогом (просмотр, сохранение)- поддержку kempston-mouse (вот где удобство!)- поддержку аппаратных часов на м/с КР512ВИ1 или аналог.- много по мелочи.Мелочи: имеется возможность вытаскивания картинки, которая былав момент сброса как с 5-ого, так и с 7-го экрана, режим гашенияэкрана для сохранения ресурса монитора ... по порядку:4. Управление:Имеются два способа управления: мышой и с клавиатуры. Если мышьопределилась, то можете управлять с обоих девайсов, если мышинет, то только с клавиатуры. Если клавиатуры тоже нет, то вамлучше застрелиться.  Интерфейс  -  оконный,  степень  вложенности  -  не более 3-х.Подкатываете  стрелочку (мышой) к нужной функции и жмете огонь -все   просто.   Стрелочка   с  клавы  не  управляется.  С  клавыперемещается  атрибутная  полоска,  которая  выделяет  выбраннуюопцию.    Поддержаны  клавиши  курсор  вверх,  вниз,  "q",  "a",  "e","space", "enter".  Клавиша  "е"  -  переход  в  режим  гашения экрана; "q", "a" -аналоги  курсорных;  пробел и ввод - выбор функции. Oтказатся отвыбора  и  вернутся  в  предыдущее  меню можно нажав "break" или"edit".Коротко о мыши. Используется т.н. драйвер пропорционального управления: подобнотому, что в zf #6, а суть простая: чем быстрее мышью двигать,темна  больший  к-т  увеличивается  реальная  координата. На словахдолго,  а  на  деле  удобно.  Коэффициент  ускорения  берется изтаблицы.   Реализовал  идею  Реаниматор,а я  ей  воспользовался.Определитель  мыши  работает  1/2  прерывания,  что  практическиисключает  возможность  неверного  определения. Реально может неопределится  мышь,  если  в  ее  счетчиках одинаковые значения вмомент сброса. Мне такого видеть не доводилось...Однако,   если  определитель  сработал  глючно,  или  по  другимпричинам,  драйвер  можно вкл/выкл в любой момент работы кнопкой"1".  О  кнопках  мыши:  левая  выстрел,  правая  - откат, средняя -гашение экрана.Стандарт на кнопки - как в ZXW, ZIP/UNZIP, UFO II (?),...Если есть мышь - то про клавиатуру можно забыть навсегда...5. Как оно выглядит после сброса.    Картинка  на  пятом  экране убирается подальше, чтобыпотом  можно было ее скинуть на диск, через одну точку очищаетсяэкран (красивый эффект), открывается главная менюшка, появляетсястрелочка (если мышь определилась), в правоm верхнем углу экранапоявляются часы (если они установлены) и все - можно юзать.Кстати о часах.  Не  имел  возможности  повторить  какую  либо  схему,  поэтомуразработал  свою...  Если  часы  есть, то во второй снизу строкеэкрана  выводится  сообщение  из  озу  часов (если оно туда былозаписано),  а  если  часов  нет,  или  они  не определились, илииндикация  была  выключена  кнопкой  "2"  (аналогично  мыши), товыводится "стандартнов" сообщение:"MR GLUK RESET SERVICE 5.1"6 Опции главного меню:6.1 Gluk boot    Boot,  который  написал я, запуск файлов - аналогично pc, наэкране - 19 файлов, если не влазят все - переключаются страницы;дисковод сканируется, если произойдет погашение экрана (через 37сек  после  последней  манипуляции  или вручную), то драйв будетпродолжать сканироваться, при попытке изьятия диска из дисководагрозно  заявит  что он все знает, и будет ждать нового диска. Неогорчайте его.  Если раздумал запускать - можешь вернутся в главное меню. bootработает  под  общим  интерфейсом, фатальных вываливаний быть неможет. Не пытайтесь подсовывать всякую гадость - уйдет в "error proc".6.2 Perfect commander  Версия  1.52,  слегка  исправленая (sorry автору), забит баг сзатиранием тела коммандера после копирования или move, исправлендрайвер  памяти,  теперь  понимает  любую  на  Профи и до 512 наПентагоне (через #7ffd).Весьма крутой коммандер.    Перед  началом  работы  проверяет  структуру  0-го  трека насоответствие   файловой   структуре  tr-dos,  если  сходство  необнаружено  (IS-DOS,  CP/M, MS-DOS) переходит в TR-dos по адресу#0000.6.3 Exit toФункция перехода, открывается еще одна менюшка:6.3.1 TR-DOS+ Выход в тырдос с открытым портом расширения из под пзу basic48,минуя определитель резидента в тырдосе.6.3.2 TR-DOS- Тоже, но запирается порт расширения. Необходим для запуска only48 прог - не понимаю их авторов...6.3.3 MENU 128  Переход  в меню 128-го бейсика, минуя задержку на запуск порта#7ffd - не нужна при програмном сбросе, сокращает время запуска.6.3.4 BASIC 48 В одноименный бейсик, порт расширения остается открытым.6.3.5 TO NOWHERE В никуда. При выборе зависает, но часы продолжают идти. Сделанодля тех, кто не любит читать описания к прогам.6.3.6 TO PROGЕще одна менюха - в какую программу перейти:6.3.6.1 TO XAS  Переход  в  XAS,  если  он  лежит  на  странице.  Любой 128-ойассемблер остается ррезидентным, если не нажимать сброс в нем, авыйти из ассемблера, а потом нажать на сброс.OUT #7FFD,#51, JP #C0006.3.6.2 TO STS Так же переход в STS, если он был предварительно загружен.OUT #7FFD,#57; JP #DB00  Обратите  внимание на номер страницы - он во втором банке 256!Но если только 128, то просто в 7-й странице. Сделано для XASа.В этот STS можно попасть и по другому: Если при нажатии на сброс удерживать клавишу "1", то произойдетвыход  в sts туда же, но при этом не будет испорчено озу, толькопотеряются регистры и режим прерываний.6.3.6.3 #14 ASSEMBLER Любой резидентный ассемблер, работающий в 4-ой странице.  Из  ныне  популярных: ZXASM, TASM 2-4, ALASM при инсталляции в4-ую страницу; много других...  После запуска ассемблера или STSа basic система остается жива,стек в порядке (RET вернет в basic).6.3.6.4 X-COPY Переход в трековый копировщик, зашитый в пзу TR-DOSа, подробнеесм. ниже.6.3.6.5 FROM ROM DISC Определяет наличие ROM-DISCа, и если он есть, переходит в него,если нет, то переход на error proc.6.3.7 RULEZ  Краткая инфа в виде бегущей строки внизу экрана, мой телефон иcopyright.6.4 MEMORY MODE: ALL   Открывается   подменюшка,   в   которой   всего  три  пункта:щALL,128,48.  Позволяет  изменить  режим  запуска из pc и bootа.Режим  сохраняется  в  часах  (если они, конечно, есть). ЗащелкаALL/128  управляется  1-м битом порта #fffc. Актуально для машин>128.6.4 ABOUT ME  Открывается  окошко  с  моими координатами. Рудимент от версии5.0.6.5 SCREEN SAVER  Открывается менюха, где предложат выбрать screen5 или screen7.после  выбора  вы  увидите заказанный экран, и при подтверждениисвоего  выбора  выстрелом  экран  скинется  на  диск  под именем"@-SCREEN".  Если  там такой уже есть, ничего страшного - их тамбудет два. Отказатся от записи и вернутся в меню выбора экрана можно нажавлюбую отличную от выстрела клавишу.6.6 DRIVE :A  Кстати,  после  двоеточия,  как  и  в MEMORY MODE отображаетсятекущее  состояние  функции, в данном случае - текущий дисковод.Функция позволяет выбрать дисковод, с которым будут производитсявсе дальнейшие операции с диском. Номер дисковода запоминается вчасах.6.7 TRACK KEEPERОткрывается подменю, где можно:- посмотреть 0 дорожку- посмотреть 161-ую дорожку- перенести 0-ую на 161- перенести 161-ую на 0-ую.Переносимая дорожка перед записью форматируется.  Умный,  т.к  его  трудно обмануть - на 161-ую дорожку кладетсяспециальный   маркер   при  сохранении,  что  впоследствии,  привосстановлении,  не  даст  загубить каталог всяким бредом - еслидиск был отформатирован на >80 дорожек. Поэтому, кстати и 161, ане 160.7 Некоторые тонкости    При  дисковых  ошибках  вылазит  менюха,  где  можно увидетьдорожку/сектор/сторону,   на   которой   произошел  сбой.  Можнопопытаться  повторить, пропустить или отменить операцию с даннымсектором. При записи картинки она не портится менюшкой, картинказаписывается из буфера, а не с экрана.  Удержание  пробела  в  момент  сброса  приводит  к мгновенномуперезапуску TR-dos по адресу 0, нужно для входа в резидент.    При  попадании  в  фатальную  ситуацию  (ABORT  при дисковыхоперациях,  отсутствие  диска  в  дисководе, отсутствие мозгов упользователя)  появляется  грозное предупреждение и генерируетсяудар  в гонг на ay и прога вываливается в главное меню; сделано,дабы  не  повторяли  юзеры  ошибок - не захочется получить такойзвук снова.    При  отсутствии  активных  действий пользователя в программеэкран плавно погаснет и полетят на нем звездочки, нажатие клавишна  любом  устройстве вернет программу в прерваный режим работы.Такого  же  эффекта  можно  добится  нажав "е" на клавиатуре илисреднюю кнопку на мыши.8 TR DOS V 5.12Не спрашивайте меня, почему 5.12 - никто не знает.8.1 Ускорение  После  сброса  проверяется наличие резидента Honey-коммандера,если  его там нет, то идем дальше, к п.8.2 Если Honey обнаружен,то  происходит  его запуск. К слову сказать, коммандер подвергсяпеределке - переделан на #7ffd драйвер верхней памяти, теперь онкак  в  Пентагоне.    НО! Переделана была версия 2.5, а другой унас нет. Если кто может помочь - help!!!!  Кроме Honey-a резидентом может остаться любая прога, даже еслиу  вас  всего  128.  Просто  необходимо  правильно  сформироватьзагрузочную страницу. Типичный пример - мой boot, только не тот,который в Пзу, а тот, который с музыкой. он остается в последнейстранице,  и занимает только ее одну, и после любого обращения кTR-DOS по адресу 0 происходит его запуск.  Также  мною  вчера  сделана  прога  в  is-dos, которая, будучизапущена,   формирует   резидент  is-dosа,  что  весьма  удобно:Работаем  в is-dos, запускаем is_res.com, нажимаем сброс, грузимчего-нибудь  (под  тырдосом, например), работаем, потом нажимаемпробел  со сбросом - быстрый перезапуск tr-dosа - и мы в IS-DOS,правда  следует  учесть  при  работе  с ram диском, что портятсястраницы #D7,#D6,#D4.8.2 Продолжим    При  запуске  тырдоса  удален  тест  памяти  - память простоочищается,  что  ускорило  запуск.  Удален  автотест  дисковода.Дисководы   принимаются   все   2х80,   шаг  6  мкс.  Интересноенаблюдение:  у  советского  5313  в  паспорте шаг нормируется неболее  3 мкс... Так что, обладатели нетурбированных контроллеровне удивляйтесь, что дисководы рычат.8.3 X-COPY  Трековый  копировщик.  Помещен  в  свободную  область тырдоса,кстати  все изменения тырдоса не коснулись родионовского вектора-#0900-#09ff, так что все проги идут ок.  Позволяет  копировать  как тырдосовские, так и профиГские СР/Мдиски,  можно  установить  последнюю  копируемую  дорожку, передзаписью    можно   диск   форматировать,   чтение   осуществляеттурболоадер,   что   при   несоответствии   выбранному   форматузацикливает на чтении - зато быстро.Перенесен без изменений из версии 5.11F.  Можно  войти  из командной строки в тырдосе : COPY A. COPY B -запуск стандартного тырдосовского копировщика.8.3 MAGIСЗначительно расширены функции волшебной кнопищи.При ее нажатии комп подвешивается, и ждет нажатия:   1   -  запуск  стандартной  проц-ры  сохранения,  только  ещесохраняется,  а  при загрузке восстанавливается и корректируетсярегистр R. 2 - то же самое, но стек помещается вниз экрана.  Предназначенодля взлома 3 - Переход в sts. BANK=#57  Два  числа  на  стеке и несколько байт в области атрибутов - взависимости  от  положения  стека.  Перед  входом  в sts гаситсямузыкалка.  PC  в  stsе показывает место останова, но не всегда.Его можно точно узнать под стеком. 4 - Возврат в программу. Выполняет функцию паузы  В  некоторых прогах стоит проверка на адрес перехода в тырдосе(#0066),  и  если магик нестандартный, то облом. В данной версиитакие  проверки не найдут отличий: перехват осуществлен в началезасирания стека.  Кстати  - не знаю я таких программ, которые не работают из подмоей  пзу или из под тырдоса 5.12 - даже если и есть одна - две,то  я  ими  пожертвовал бы ради всего этого кайфа... Правда, щаснарод все больше на эмуляторах...8.4 FORMATTER  После  ввода  FORMAT  "NAME"  появляется стандартный запрос наобычный  или  турбо  формат, при выборе турбо формата диск будетформатироватся  с  радиальным  смещением  секторов  -  на каждойследующей  дорожке  сектора  начинаются позже, чем на предыдущейдля  компенсации  задержек  в  программе  и  шага дисковода. Прикопировании в PC дает ощутимый выигрыш во времени.9.0 Заключение  Ну  вроде  основные  моменты  описал все... Есть еще небольшиетонкости,  но  там по ходу дела все понятно, а если непонятно  -могу  раз'яснить.  Надеюсь,  что  кого-нибудь  это заинтересует.Продукт  freeware,  автор  - Мистер Глюк - я, изменение кода безмоего ведома настоятельно не рекомендуется.    Авторство    отдельных   фрагментов   частично   принадлежитРеаниматору, с коим мы работали вместе до выхода 5.0, но потом яделал все один, кроме некоторых мелочей.  Комп,  на  котором  все  сделано:  пень  256,  cmos clock, resserv5.0,  trd  5.11f,  stereo  covox,  megascreen port, kempstonmouse,  ay  interface,  2x fdd 5'25, 1x fdd 3'5 minitower, hayesinterface, монитор 32ВТЦ202.Used software:  XAS 6.18, 9.xx, STS 5.1ALASM, STS 5.1XAS, ZX-word 2.5+kempstonmouse, iS-dos 5.xx, e.t.c.глюк - это навсегда ...26.01.98  Мистер Глюк, в миру Ренат из Иванова (37-21-90).
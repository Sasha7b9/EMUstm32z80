Newsgroups: fido7.zx.spectrumFrom: Sergey Egorov <Sergey.Egorov@p17.f28.n5026.z2.fidonet.org>Date: Fri, 06 Jun 97 13:57:42 +0400Subject: New ROM presentation.     ТОВАРИШИ ALL! ВСЕ, КТО ЕЩЕ НЕ ПОХОРОНИЛ СПЕКТРУМ!Прочтите данное описание, и если у вас есть какие-либо эмоции,или вы хотите _это_ иметь, пришлите нам свои условия, мы непротив продать вам свое творение! Возможна оплата пивом! Рыбу кпиву тоже принимаем!Найти нас можно в Иванове, но лучше по телефону или по Net'у.мой телефон 37-21-90 (Ренат)его номер 32-43-90 (Роман).Или пишите письма Роме (мой почтовый ящик болеет склерозом):153000, г. Иваново, ул. Ноздрина, д 34, кв 38        Гаврилову Роману Александровичу.                  ОПИСАНИЕ RESET SERVICE V5.0                      1. ПРЕДМЕТ И ФУНКЦИЯ                                      "-Ты кто?                                      -Сам дурак!"                                       (из беседы в DSC)Предметом данного описания является некая программа, написаннаянекоим Мистером ГЛюком и некоим Реаниматором. (первый - это я.)Данная программа относится к классу прикладных. Прикладывают(зашивают) ее в 32к ПЗУ, причем первая часть - чисто сервисная,зашивается в верхние 16к микросхемы 27512, а вторая часть -новая версия TR-DOS, причем, сразу хочу обломитькритиканствующих юзеров (типа: ОНИ Дос поменяли!!! Да онаНЕСОВМЕСТИМА!!!) - на сегодняшний день мы не знаем прогов,которые не идут на нашей TR-DOSе.Даже те глупые проги, которые проверяют обработку NMI в TR-DOSе,обламываются - по их мнению, NMI нормальный (мы их обманываем!).Сразу хочу свалить немного в сторону от темы (мое любимоезанятие) и сказать тем, кто проверяет ПЗУ на стандартность, либолазают в ПЗУ непонятно куда - вы нехорошие люди. Такими глупымиметодами вы только сужаете круг пользователей.Теперь о совместимости верхней (сервисной) части. Никакойсовместимости нет и быть не пожет в принципе, ибо нет способов(а точнее, есть один, но он не проверенный) обратиться в старшие16к не по сбросу. Может, какая навернутая тачка и имеет такуювозможность, но мы о них не знаем, да и ценность обращенияприближается к нулю. Всегда можно нажать сброс.Если ваш комп не может обратится в старшие 16к даже по сбросу,то сделать такую возможность просто элементарно. НаПентагоне 48 /любое расширение (я имею в виду платы 48-го пня,расширенные до ... кб) это просто кнопка RESET DOS.В Профи на старших 16к зашит совершенно бесполезный тест, иботест нужен тогда, когда комп глючит, а если он глючит, то егонадо нести в ремонт или на свалку. Работать же с этим тестом(а как это?) невозможно, т.к. в нем нет ничего полезного дляповседневной работы. /При повторном прочтении пользователине-Профи данный абзац могут пропускать/Если вы не знаете, каким концом паяльник включается куда (ярозетку имел в виду, а вы что подумали?), то можете обратиться кнам, мы вам все сделаем очень дешево и на высшем уровне.                    2. ИСТОРИЧЕСКАЯ СПРАВКА                               "Да у вас, батенька,                               запоры!"                                  из телепередачи.Копнем, как однажды сказал Химик, историческое дерьмо. Итак:В начале было слово.Следующие пару тысячелетий можно пропустить, потому что ничегопримечательного там не происходило.Потом был "КРАМИС". Он был красивый, и до сих пор некоторымнравится своей бордюрно-полосатостью. Тест этот был нервный, икаждую секунду вздрагивал полосками на бордюре. Видимо, это иопределило его скоропостижную смерть, а также полное отсутствиепрактической пользы. Единственная полезная функция - выход вTR-DOS из-под 48-го бейсика с открытым портом, а также тест.Потом был (и сейчас есть) тест для Профи, свое отношение к немуя высказал в первой главе. Истинным профивцам он, видимо,нравится тем, что работает на большом (ПРОФИ) экране. Другихпричин его иметь как-то не просматривается...Потом был Вадим... Собственно говоря, он и сейчас жив(представьте себе!), но, к счастью, со спектрума свалил на PC(так им и надо!).Так вот, этот самый Вадим написал свою Пзу.Прога эта была всем хороша - глючила, тормозила, делала глупости- в общем, единственной полезной функцией там была опция"ВЫХОД". Именно появление Вадимовской Пзу и подтолкнуло менясерьезно взяться за эту область, хотя сделать нечто подобное яхотел еще во времена КРАМИСа.Потом появился Реаниматор, человек, полностью мнепротивоположный. Наши мнения расходятся практическои во всем.Разве что пиво любим наше, ивановское.Краткая хронология:Версии до 4.0Встроенный OMEGA COMMANDER, с поддержаным режимом резидента,имелась возможность выхода в любую страницу, был выход в XAS, вSTS. Имелся диск доктор, написанный Ковалевским и доглюченныймною. Возможность выдирания картинок с обоих экранов - сохраненодо сих пор. Управлялся стрелочкой.Версия 4.0Впервые вставлен PERFECT коммандер. Куча глюков. Появиласьвозможность выхода в STS с удержанием пробела с порчей только5-ти байт. Доктор оставлен старый. Режим сохранения ресурсамонитора - плывущие звезды. Из экономии памяти стрелочныйинтерфейс заменен курсорным.Версия 4.1Та же 4.0, но с убитыми глюками и другими цветами.Версия 4.2Похожа на 4.1, но несколько расширены возможности, имеетсявозможность выбора дисковода для работы, и другие приятные вещи.Удалена функция перехода на любую страницу из-занеиспользования.Версия 5.0Та самая, в help к которой ты и уставился.... Видел бы себя состороны...Относительно версий TR-DOSа ничего сказать не могу - каждаяновая версия сервисной части сопровождалась новым TR-DOSом, аномер версии изменялся только два раза.                    3. ОПИСАНИЕ ВОЗМОЖНОСТЕЙ                              " -Что можешь?                              -Могу копать.                              -А еще?                              -Могу не копать."                                  (глупый анекдот)Страшно даже начинать...После нажатия на сброс дисковод мгновенно остановится, кстати, ипри любых манипуляциях с диском диск будет крутиться толькотогда, когда это нужно, и не будет доставать жалобным урчанием,если операция закончена.После этого появится здоровая менюшина, управление которойпроизводится клавишами курсора (вврех и вниз) а также "Q" и "A".Подтверждение выбора - пробел или ENTER. Нажатие клавиш BREAKили EDIT производит отказ от функции (BREAK) и/или вываливание впредыдущее меню.Если в течении 37 секунд по Пугинским часам (по моим - 36секунд, а Ромины часы почти всегда стоят) не проявлять признаковжизни по отношению к клавиатуре и магнитофонному гнездутелевизора (шутка, если кто не понял), то произойдет плавноепогасание экрана, а затем появится узкая полоса, проходящая повсему экрану (включая область бордюра), через которую вы будетевидеть содержимое 7-го экрана. Полоса эта плавно перемещается повертикали, и когда она достигнет верхнего края экрана, топоявится на обоях... а затем поползет вниз, а там, подостижении нижнего края (на ковре) цикл повторится и будетповторяться, пока вы не потрогаете какую нибудь (лучше RESET)клавишу. Такого же эффекта можно добиться и не дожидаясь 37/36/0секунд, а просто нажав клавишу "Е".Все ошибочные ситуации отловлены, и никогда вы не увидите (вэтой программе) никаких ошибочных сообщений. Вместо них выполучите ласковое извещение, напоминающее о вашем статусе ипродолжительности жизни (LAMERS MUST DIE TODAY!". /Спасибо DR заидею./ После подобной идентификации программа вывалится вглавное меню. Конкретизировать ошибку можно, осмотрев состояниедиска (заклеен/нет места/дохлый/нет вовсе/не так вставлен/то лилыжи не едут...), так как все ошибки происходят только приработе с диском.Также при сбросе настраивается м/с ВВ55, если она есть.Теперь пройдемся по главному меню:                     3.1 PERFECT COMMANDERНаикрутейший коммандер, за основу была взята версия 1.52. Полноеописание прилагается. Стоит заметить, что, в отличие оторигинальной версии, убиты все найденные в процессе длительнойэксплуатации глюки, а также сделан верно драйвер верхней памяти,так что теперь на Профи все будет определено верно, иопределится до 512к на расширении по #7FFD (Пентагон и др.)                         3.2 EXIT TO...После выбора этой опции появится еще одна менюшка, где вам будетпредложено определить место, куда будете выходить:                         3.2.1 TR-DOS+Выход в TR-DOS с открытым портом расширения под Пзу BASIC-48.(JP #0000. см также описание резидента Honey'a)                         3.2.2 TR-DOS-То же самое, но порт будет закрыт. Не понимаю уродов, пишущихONLY48K. Для борьбы с ними и сделана эта опция.                        3.2.3 BASIC 128Выход в Пзу 128. Никаких изменений. Скоро и до него доберемся...                         3.2.4 BASIC 48Выход в BASIC 48 с открытым ртом... пардон, портом./каламбурчик-с/                        3.2.5 TO PROGRAMВыход в любимую программу. После выбора этой опции откроется ещеодна менюшка (получите!), где и будет представлен список любимыхпрограмм:                          3.2.5.1 XASБесспорный (наверное) лидер среди ассемблеров, занимает почетноепервое место. Делается OUT #7FFD,#51; JP #C000.                          3.2.5.2 STSБесспорный лидер среди STSов. Делается OUT #7FFD,#57; JP #DB00.Обратите внимание на номер страницы! Если у вас больше 128, тозапустится STS из 7-ой страницы в старших 256. STS из 7-ойстраницы (если RAM больше 128к) не запустится, а запустится STSиз 7-ой страницы в 256-ой памяти.                         3.2.5.3 #14ASMЛюбой ассемблер в 4-ой странице. Из ныне популярных: MASM,ZXASM, TASM, ALASM (при инсталляции в 4-ую страницу)При выходе в XAS, STS, #14ASM BASIC система будет жива, ERR_SP -где надо, RAMTOP - тоже где надо, стек около 24575. Жить можно.Не могу не процитировать rom-help for v4.2: "Представляю себелицо счастливого юзера, который обнаружил, что у него в ПЗУ иXAS, и STS, и еще какой-то #14ASM. Бедняга! Все вместе эти трипроги занимают 137 байт."                         3.2.5.4 X-COPYВыход в трековый копировщик, зашитый в ПЗУ TR-DOS. Если TR-DOSне от нас, то погружение в Нирвану не произойдет, а скореевсего, дело кончится лысиной. (волосы будете рвать на себе.)                          3.3 SERVICEВыход в программу работы с диском. Позволяет форматировать,проверять и восстанавливать диски. Форматирование происходит сосмещением секторов в обход битых участков на диске.Подробного описания нет, т.к. нужно быть совсем длинноухимживотным, чтобы не разобраться. Программа установлена вместоДиск-доктора, который всех достал.Выход назад в Пзу не предусмотрен, так как этот FUCK активнопользуется всей памятью 48к, а порча страниц не входит в моипланы. Топите сброс для выхода.                   3.4 TRK 0>161 и TRK 0<161Функции соответственно сохранения и восстановления системнойдорожки. Перед записью 161-ая (или 0-ая - в зависимости отоперации) дорожка форматируется. Записывается 9 секторовстандартного TR-DOS формата. Применение функции на защищенныхдисках приведет к плачевным последствиям. Как снять защиту отesv-protесtor'а, я здесь писать не буду, кому интересно -читайте на ночь help for v4.1, v4.2. Если каталог не былпредварительно сохранен, то уничтожения нулевой дорожки непроизойдет, а вы получите ERROR MESSAGE (то самое). Наличиеспасенного каталога определяется по идентифакационному байту, ане просто по наличию 161-ого трека.                        3.5 SCREEN SAVERКак следует из названия, функция предназначена для выдираниякартинок из программ. После входа в Пзу 5-ый экран прячетсяподальше от чужих глаз, а 7-ой остается там, где и был. Так вот,после выбора этой опции появится еще одна менюшка, где и будетпредложено достать либо 5-ый, либо 7-ой экран из потайного местаи предъявить для просмотра, либо вовсе вернуться в главное меню.После выбора номера экрана вы его увидите, и программа будетждать, пока вы оправитесь от увиденного и не нажмете что-нибудь.Если клавишей "что-нибудь" случайно окажется ENTER, то данныйэкран скинется на диск под загадочным именем "@-SCREEN", причем,если на диске уже есть такой файл, то их там будет дваодинаковых (чтобы не скучали). Если места нет, либо другаяобломина - получишь испанскую инквизицию в виде привычного"LAMERS..."                          3.6 ABOUT MEИнформация об авторах данной программы и мой телефон. Всегда(когда я дома и в состоянии говорить) любые консультации. Есликого-либо наше творение заинтересовало - милости просим - можемпоказать и все обьяснить, а там решите надо это вам или нет(нужное подчеркнуть).                          3.7 DRIVE: AВыбор рабочего дисковода. После выбора опции откроется менюс четырьмя буквами. Выберите нужную букву и вперед. Номертекущего дисковода будет виден в названии опции после двоеточия.Все дисковые операции будут работать с текущим дисководом.Perfect commander и Fuck utilite запустятся с текущего (намомент запуска) дисковода. Посля сброса текущим дисководомстановится "А". Дисководы не тестируются, принимаются поумолчанию 2х80, step 6mks, т.к. других мне встречать неприходилось.                         3.8 !!!!!!!!!Вот, вроде, и закончились опции.Теперь о главном, Федя...Если во время сброса удерживать клавишу "1", то попадете в STS в7-ую страницу в старших 256к. При этом не испортится ни одногобайта в ОЗУ, только будут потеряны некоторые регистры и режимпрерываний. Перед выходом в STS отрабатывается некотораязадержка. Задержка из-за того, что на некоторых паталогах порт#7FFD запускается не одновременно с процессором, а немногопозже. Вот эта задержка и компенсирует убогость схемотехникивашего паталога.Если при сбросе удерживать пробел, то произойдет мгновенноевываливание в TR-DOS+, а зачем это нужно, вы узнаете прочитавописание TR-DOSа, а точнее, поддержки режима резидента HONEYCOMMANDERA.А вот и оно:                       3.9 TR-DOS V 5.11FВ качестве базовой версии использовалась версия 5.04Тнеизвестного автора. Жаль, если он уже умер...При входе в TR-DOS по адресу 0 происходит проверка наличиярезидента HONEY COMMANDERA, и, если он там есть, то произойдетвываливание в него. Но не стоит сильно радоватся. ФирменныйHONEY в таком режиме работать не будет, а вернее, будет, но наАТМе, откуда и была взята идея резидента. РЕЗИДЕНТ возможен налюбом(!) спектрум спвместимом, но (!):1. объем ОЗУ не менее 512к (хотя на 256 тоже работает не хуже);2. ОЗУ расширено через #7FFD;3. HONEY дали мы, т.к. мы его исправили;4. ПЗУ TR-DOS стоит наше.Требования неслабые, но зато как круто!Теперь рассмотрим ситуацию, если резидент не обнаружен.Произойдет быстрая очистка памяти без тестирования, что примернов три раза ускорило запуск.Также удален автотест дисководов - головка не елозит теперь подиску, издавая адские звуки. Дисководы принимаются по умолчаниюдвухсторонние, 80-ти дорожечные, с шагом 6 мкс. Если вашдисковод не удовлетворяет этим условиям, то работа будетзатруднена. Не стоит расстраиватся, такие нестандартныедисководы уже давно не выпускают, и мне они в эксплуатации непопадались.Если из командной строки в TR-DOSе ввести COPY A, то войдете втрековый копировщик X-COPY. В него можно попасть и из сервиснойПЗУ, если она есть.Копировщик позволяет копировать стандартные TR-DOS и стандартныеCP/M (Profi) диски. TR-DOS диски можно копировать и сформатированием. Можно установить и последнюю копируемуюдорожку.На чтение использован турболоадер, при форматировании дискформатируется со смещением секторов на соседних дорожках - всеэто делает процесс копирования простым и удобным.Память определяется так: вся доступная память минус восемькилобайт (128-8=120к!) Поддержаны расширения памяти - Профи влюбом вариянте и до 512 на Пентагоне через #7FFD.Также в нашем TR-DOSе улучшена программа форматирования -теперь, если выбрать быстрый формат, то диск будетотформатирован со смещением секторов на соседних дорожках, чтосделает его еще быстрее.Изменена процедура MAGIC. После нажатия на одноименную кнопищупрограмма подвисает, да не совсем, а будет ждать нажатиянекоторых кнопочек, а именно:"1" - запуск стандартной процедуры. В файл, кроме того,будет записан и регистр регенерации, что иногда бываетнужно. Совместимость со старым форматом сохранена."2" - запуск стандартной процедуры, но стек будетпереставлен в низ экрана. Такой файл уже будет не запустить,но можно использовать для взлома защиты, основанной напокладании стека наверх экрана."3" - выход в STS. Не портятся регистры, режим работыпрерываний, память. В памяти портится только около 8-ми байтв зависимости от положения стека. Если стек наверху, тооколо 8-ми байт будет потеряно в области атрибутов экрана.Запускается STS из 256-ой страницы, после входа в негозаткнется музыкалка, а указатель адреса в STSе будетуказывать на место останова программы. К сожалению,указатель адреса в некоторых случаях не будет указыватьместо останова - из-за недостатка STSа. Но этот адрес можноузнать - он лежит под стеком. Так что проблем нет."4" - возврат в прпграмму. Можно использовать как кнопку паузы.Ну вот, вроде, и все по описанию.                        4 TECHNICAL INFOПри написании программы использован следующий хард и софт:Пентагон 256 +... и Профи+ v3.2 +...XAS V3.0, ALASM 3.8, STS4.3, STS5.0, MS-PACKER, PCD, RES SERV V4.2, EDITOR, ZX-World 2.52, PITON e.t.c.Больше ничего не помню...                          5 ЗАКЛЮЧЕНИЕНу вот, убойная работа в текстовом редакторе подходит к концу.Напоследок несколько пожеланий.Во первых, желаю вам, чтобы вам настолько понаравилась наша Пзу,что кнопка RESET стала бы вашей любимой кнопкой, и всем версиямANY KEY вы предпочитали бы ее.Во-вторых, желаю вам стать нашими клиентами, а в лучшем случае,друзьями.В-третьих, желаю много пива и рыбы к нему.В-четвертых, пропустим из соображений цензуры.И ваще, всего самого-самого.                       6 АВТОРЫ И ПРИВЕТЫНаписал этот help я, Мистер Глюк.Идеи были общие, но моих было больше; В TR-DOSе ковырялсяРеаниматор; PERFECT и исправлял Реаниматор, DISC SERVICE лепилтоже он; Сервисную часть писал Мистер Глюк; Всякие мелочи делалипо очереди Мистер Глюк и Реаниматор.БОЛЬШЕ НИКТО ПАЛЬЦЕМ НЕ ПОШЕВЕЛИЛ, ТАК ЧТО ВСЮ СЛАВУ НАМ!!!Особый привет тем двум человекам, которые позвонили, прочитав"DI HALT#1" - какова популярность! Звоните еще...                          Мистер ГлюкP.S. Кто-то must die...P.P.S. Что-то там rules и outside...P.P.P.S. Извините за почерк, очень тороплюсь...